# LegibleSync DSL Example
# This file demonstrates the declarative sync rule format

# Sync Rule Name: CreateArticle
# This sync creates an article after JWT verification succeeds
sync CreateArticle

# When Clause: Defines the pattern of actions that must occur
when {
  # First, a Web request must be made to POST /articles
  # The output captures the request ID as ?req
  Web/request: { method: "POST", path: "/articles" } => { request: ?req }
  
  # Then, JWT verification must succeed
  # The output captures the authenticated user as ?user
  JWT/verify: { token: ?token } => { user: ?user }
}

# Then Clause: Defines the actions to execute when the pattern matches
then {
  # Create a new article with:
  # - A unique ID generated by uuid()
  # - Title and body from the request body (?body.title, ?body.body)
  # - Author set to the authenticated user (?user)
  Article/create: { article: uuid(), title: ?body.title, body: ?body.body, author: ?user }
}

# Variable Binding Syntax:
# - ?variableName: Binds a value from input/output
# - ?object.field: Accesses nested fields
# - uuid(): Generates a unique identifier
#
# Pattern Matching:
# - Concept/action: { input } => { output }
# - Input patterns can use exact values or variables
# - Output patterns bind variables for use in subsequent rules